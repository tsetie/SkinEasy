<!-- reviews.html -->
<!-- SkinEasy Product Reviews Page -->

<!-- Inherits from: -->
{% extends "base.html" %}

<!-- Title  -->
{% block title %}Reviews{% endblock %}

<!-- Head -->
{% block head %}
  {{ super() }}
 
    <!-- Pure CSS -->
    <link rel="stylesheet" href="https://purecss.io/layouts/side-menu/styles.css">

    <!-- javascipt -->
    <script src="https://purecss.io/js/ui.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/home.css">
    <link rel="stylesheet" href="/static/css/reviews.css">
    <link rel="stylesheet" href="/static/css/review_form.css">

    <!-- External CSS libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


     <!-- JS -->
     <script type="text/javascript" async defer src="/static/js/reviews.js"></script>
     <script type="text/javascript" async defer src="/static/js/account.js"></script>

{% endblock %}
{% block content %}

    <div id="main">
        <!-- Product displayed at top -->
        <div class="header">
            <h1>Product Reviews</h1>
            <h2> {{ product_details['product_name'] }} </h2>
            <div class="product-img-container">
                <img class="pure-img-responsive review-img" src="{{ product_details['image_path'] }}" alt="image of a product">
            </div>
            <!-- Reference to format price in jinja2: https://documentation.bloomreach.com/engagement/docs/useful-jinja-snippets#:~:text=Display%20price%20with%202%20decimal%20places%20If%20your,%7B%20%22%250.2f%22%20%7C%20format%20%28item.price%20%7C%20float%29%20%7D%7D-->
            <div class="product-reviews-container">
                <p> ${{  "%0.2f" | format(product_details['price'] | float) }} </p>
            </div>
            
        </div>
    <div>
    <!-- Only let user write a review if logged in  -->
    {% if session %}
        <!-- Container for make review button -->
        <div id="addReviewDiv">
            <button id="writeReviewBtn" >Write a review</button>
        </div>

        <!-- Write review form -->
        <div id="add-review-form-container">
            {% include "add_review.html" %}
        </div>
    {% endif %}

    {% if review_list %}
        <div class='pure-g'>
                <!-- Loop through each review from the database function and display -->
                <!-- Reference to get list length via jinja2: https://stackoverflow.com/questions/14702917/python-jinja2-template-how-to-count-a-list -->
                {% for i in range(0, review_list|count) %}
                    <!-- NOTE: Each review is stored in a size '1' list for some reason, so just remove the list part by indexing first element -->
                    {% set review = review_list[i][0] %}
                    <div class='pure-u-1' id="review_container">
                        <div class="boxheader">
                            <h3>{{ review['reviewer_name'] }}</h3>
                            <br>
                            {% for i in range(0, 5)  %}
                                {% if review['rating'] > i %}
                                    <span class="fa fa-star checked star"></span>
                                {% else %}
                                    <span class="fa fa-star star unchecked"></span>
                                {% endif %}
                            {% endfor %}

                            <!-- Review title -->
                            <h4 id="content_title">{{ review['title'] }}</h4>

                            <!-- Review date -->
                            <h4>{{ review['to_char'] }}</h4>
                            
                            <!-- Review image -->
                            {% if review['img_stream'] != None %}
                                <div class="review-img">
                                    <img class="pure-img-responsive" src="/images/{{review['review_id'] }}" alt="image of a product">
                                </div>
                            {% endif %}

                            <!-- Review content -->
                            <div class="review-content">
                                <p>
                                {{ review['content'] }}
                                </p>
                            </div>
                    </div>
                    <hr>
                {% endfor %}
            </div>
            <div pure-u-1>

            </div>
        </div>
    {% endif %}

    <!-- Only show this meesage if theres no reviews for the product yet  -->
    {% if review_list == false %}
    <h2 id="no_review_msg"> No reviews yet.</h2>
    {% endif %}

{% endblock %}